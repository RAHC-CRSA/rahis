<c-row ngPreserveWhitespaces>
  <c-col xs="12">
    <c-card class="mb-4">
      <c-card-header>
        <strong>Create User</strong>
      </c-card-header>
      <c-card-body>
        <form cForm [formGroup]="userForm" novalidate="novalidate" (ngSubmit)="submit()" class="needs-validation">
          <ng-container *ngIf="hasError" class="alert alert-danger">
            <p class="text-red">The form is invalid</p>
          </ng-container>
          <c-row class="g-3 mb-3">
            <c-col xs>
              <input aria-label="First name" cFormControl formControlName="firstName" placeholder="First name"
                [ngClass]="{
                'border border-danger':
                  userForm.controls['firstName'].touched &&
                  userForm.controls['firstName'].invalid
              }" />
              <ng-container [ngTemplateOutlet]="formError"
                [ngTemplateOutletContext]="{validation: 'required', message: 'First name is required', control: userForm.controls['firstName']}"></ng-container>
              <ng-container [ngTemplateOutlet]="formError"
                [ngTemplateOutletContext]="{validation: 'minlength', message: 'First name should have at least 3 characters', control: userForm.controls['firstName']}"></ng-container>
            </c-col>
            <c-col xs>
              <input aria-label="Last name" cFormControl formControlName="lastName" placeholder="Last name" [ngClass]="{
                'border border-danger':
                  userForm.controls['lastName'].touched &&
                  userForm.controls['lastName'].invalid
              }" />
              <ng-container [ngTemplateOutlet]="formError"
                [ngTemplateOutletContext]="{validation: 'required', message: 'Last name is required', control: userForm.controls['lastName']}"></ng-container>
              <ng-container [ngTemplateOutlet]="formError"
                [ngTemplateOutletContext]="{validation: 'minlength', message: 'Last name should have at least 3 characters', control: userForm.controls['lastName']}"></ng-container>
            </c-col>
          </c-row>
          <c-row class="mb-3">
            <c-col>
              <select aria-label="Role" cSelect formControlName="role" [ngClass]="{
                'border border-danger':
                  userForm.controls['role'].touched &&
                  userForm.controls['role'].invalid
              }">
                <option [ngValue]="null" [disabled]="true" [selected]="true">Select role</option>
                <option *ngFor="let role of roles$ | async; index as i" value="{{ role }}">{{ role }}</option>
              </select>
              <ng-container [ngTemplateOutlet]="formError"
                [ngTemplateOutletContext]="{validation: 'required', message: 'Role is required', control: userForm.controls['role']}"></ng-container>
            </c-col>
          </c-row>
          <c-row class="mb-3">
            <c-col xs>
              <input type="email" aria-label="Email address" cFormControl formControlName="email"
                placeholder="Email address" [ngClass]="{
                'border border-danger':
                  userForm.controls['email'].touched &&
                  userForm.controls['email'].invalid
              }" />
              <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
                validation: 'required',
                message: 'Email is required',
                control: userForm.controls['email']
              }"></ng-container>
              <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
                validation: 'email',
                message: 'Email is invalid',
                control: userForm.controls['email']
              }"></ng-container>
              <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
                validation: 'minlength',
                message: 'Email should have at least 3 characters',
                control: userForm.controls['email']
              }"></ng-container>
              <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
                validation: 'maxlength',
                message: 'Email should have maximum 360 symbols',
                control: userForm.controls['email']
              }"></ng-container>
            </c-col>
          </c-row>
          <c-row class="g-3 mb-3">
            <c-col xs>
              <input aria-label="Password" type="password" cFormControl formControlName="password"
                placeholder="Password" autocomplete="false" [ngClass]="{
                'border border-danger':
                  userForm.controls['password'].touched &&
                  userForm.controls['password'].invalid
              }" />
              <ng-container [ngTemplateOutlet]="formError"
                [ngTemplateOutletContext]="{validation: 'required', message: 'Password is required', control: userForm.controls['password']}"></ng-container>
              <ng-container [ngTemplateOutlet]="formError"
                [ngTemplateOutletContext]="{validation: 'minlength', message: 'Password should have at least 8 characters', control: userForm.controls['password']}"></ng-container>
              <ng-container [ngTemplateOutlet]="formError"
                [ngTemplateOutletContext]="{validation: 'passwordRule', message: 'Password should have at least one uppercase character, one lowercase character, and one symbol', control: userForm.controls['password']}"></ng-container>
            </c-col>
            <c-col xs>
              <input aria-label="Confirm Password" type="password" cFormControl formControlName="confirmPassword"
                placeholder=" Confirm Password" autocomplete="false" [ngClass]="{
                  'border border-danger':
                    userForm.controls['confirmPassword'].touched &&
                    userForm.controls['confirmPassword'].invalid
                }" />
              <ng-container [ngTemplateOutlet]="formError"
                [ngTemplateOutletContext]="{validation: 'required', message: 'Password confirmation is required', control: userForm.controls['confirmPassword']}"></ng-container>
              <ng-container [ngTemplateOutlet]="formError"
                [ngTemplateOutletContext]="{validation: 'confirmedValidator', message: 'Passwords must match', control: userForm.controls['confirmPassword']}"></ng-container>
            </c-col>
          </c-row>

          <c-row>
            <c-col>
              <button cButton type="submit" class="px-4" color="primary" [disabled]="userForm.invalid">
                Submit
              </button>
            </c-col>
          </c-row>
        </form>
      </c-card-body>
    </c-card>
  </c-col>
</c-row>

<ng-template #formError let-control="control" let-message="message" let-validation="validation">
  <ng-container *ngIf="control.hasError(validation) && (control.dirty || control.touched)">
    <div class="text-danger p-2"><small>{{ message }}</small></div>
  </ng-container>
</ng-template>