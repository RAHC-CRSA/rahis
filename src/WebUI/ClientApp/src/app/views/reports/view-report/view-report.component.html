<div class="flex flex-col flex-auto min-w-0">

  <!-- Header -->
  <div
    class="flex flex-col sm:flex-row flex-0 sm:items-center sm:justify-between p-6 sm:py-8 sm:px-10 border-b bg-card dark:bg-transparent">
    <div class="flex-1 min-w-0">
      <!-- Breadcrumbs -->
      <div class="flex flex-wrap items-center font-medium">
        <div>
          <a class="whitespace-nowrap text-primary-500">Reports</a>
        </div>
        <div class="flex items-center ml-1 whitespace-nowrap">
          <mat-icon class="icon-size-5 text-secondary" [svgIcon]="'heroicons_solid:chevron-right'"></mat-icon>
          <a class="ml-1 text-primary-500">View Report</a>
        </div>
      </div>
      <!-- Title -->
      <div class="mt-2">
        <h2 class="text-3xl md:text-4xl font-extrabold tracking-tight leading-7 sm:leading-10 truncate">
          View Report
        </h2>
      </div>
    </div>
  </div>

  <!-- Main -->
  <div class="flex-auto p-6 sm:p-10">

    <div class="w-full">

      <div class="p-4 bg-card shadow rounded overflow-hidden">

        <!-- Alert -->
        <app-feedback-display *ngIf="feedback$ | async" [feedback]="feedback$"></app-feedback-display>

        <div class="spinner-container" *ngIf="loading$ | async">
          <mat-spinner></mat-spinner>
        </div>

        <div class="w-full">
          <div class="flex gap-3">
            <div class="w-24 p-2" *ngIf="(report$ | async)?.occurrenceCountryFlag">
              <img [src]="( report$ | async)?.occurrenceCountryFlag" alt="" class="w-auto">
            </div>
            <div class="w-full">
              <h3 class="text-3xl">{{ (report$ | async)?.occurrenceTitle }}</h3>
              <h4 class="text-2xl">{{ (report$ | async)?.occurrenceRegion }}</h4>
            </div>
          </div>

          <!-- Notifiability display -->
          <div *ngIf="canNotify" class="w-full my-4">
            <fuse-alert *ngIf="(report$ | async)?.notifiabilityPoints >= 7" [type]="'error'" [appearance]="'outline'">
              <span fuseAlertTitle>Notification Recommended</span>
              We recommend an immediate notification click the button to send email notifications to relevant parties.
              <div class="my-3">
                <button *ngIf="canNotify" class="px-8" mat-flat-button [color]="'error'" type="button"
                  (click)="sendNotification()">
                  <span *ngIf="!( loading$ | async )">
                    Send Notification
                  </span>
                  <mat-progress-spinner *ngIf="( loading$ | async )" [diameter]="24"
                    [mode]="'indeterminate'"></mat-progress-spinner>
                </button>
              </div>
            </fuse-alert>

            <fuse-alert
              *ngIf="(report$ | async)?.notifiabilityPoints >= 4 && (report$ | async)?.notifiabilityPoints < 7"
              [type]="'warning'" [appearance]="'outline'">
              <span fuseAlertTitle>Notification Optional</span>
              You can optionally send a notification to all relevant parties.
              <div class="my-3">
                <button *ngIf="canNotify" class="px-8" mat-flat-button [color]="'warn'" type="button"
                  (click)="sendNotification()">
                  <span *ngIf="!( loading$ | async )">
                    Send Notification
                  </span>
                  <mat-progress-spinner *ngIf="( loading$ | async )" [diameter]="24"
                    [mode]="'indeterminate'"></mat-progress-spinner>
                </button>
              </div>
            </fuse-alert>

            <fuse-alert *ngIf="(report$ | async)?.notifiabilityPoints < 4" [type]="'success'" [appearance]="'outline'">
              <span fuseAlertTitle>Notification Optional</span>
              <ng-container *ngIf="!(report$ | async)?.isDiseaseNotifiable && !(report$ | async)?.isDiseaseMonitored">
                Non-threatening report, no notifications necessary.</ng-container>
              <ng-container *ngIf="(report$ | async)?.isDiseaseNotifiable || (report$ | async)?.isDiseaseMonitored">This
                is a
                monitorable/notifiable disease, would you like to notify?</ng-container>
              <div class="my-3">
                <button *ngIf="canNotify" class="px-4" mat-flat-button [color]="'primary'" type="button"
                  (click)="sendNotification()">
                  <span *ngIf="!( loading$ | async )">
                    Send Notification
                  </span>
                  <mat-progress-spinner *ngIf="( loading$ | async )" [diameter]="24"
                    [mode]="'indeterminate'"></mat-progress-spinner>
                </button>
              </div>
            </fuse-alert>
          </div>
          <!-- /Notifiability display -->

          <hr>

          <div class="mb-8">
            <table mat-table [dataSource]="(actionsInfoData$ | async)" class="w-full">
              <!-- Stamping-out Column -->
              <ng-container matColumnDef="stampingOut">
                <th mat-header-cell *matHeaderCellDef class="text-center"> Stamping-out </th>
                <td mat-cell *matCellDef="let el" class="text-center">
                  <mat-icon *ngIf="el.stampingOut" color="primary" svgIcon="heroicons_solid:check-circle"></mat-icon>
                  <mat-icon *ngIf="!el.stampingOut" color="danger" svgIcon="heroicons_solid:minus-circle"></mat-icon>
                </td>
              </ng-container>

              <!-- Destruction of corpses Column -->
              <ng-container matColumnDef="destructionOfCorpses">
                <th mat-header-cell *matHeaderCellDef class="text-center"> Destruction of Corpses </th>
                <td mat-cell *matCellDef="let el" class="text-center">
                  <mat-icon *ngIf="el.destructionOfCorpses" color="primary"
                    svgIcon="heroicons_solid:check-circle"></mat-icon>
                  <mat-icon *ngIf="!el.destructionOfCorpses" color="danger"
                    svgIcon="heroicons_solid:minus-circle"></mat-icon>
              </ng-container>

              <!-- Treatment Column -->
              <ng-container matColumnDef="treatment">
                <th mat-header-cell *matHeaderCellDef class="text-center"> Treatment </th>
                <td mat-cell *matCellDef="let el" class="text-center">
                  <mat-icon *ngIf="el.treatment" color="primary" svgIcon="heroicons_solid:check-circle"></mat-icon>
                  <mat-icon *ngIf="!el.treatment" color="danger" svgIcon="heroicons_solid:minus-circle"></mat-icon>
              </ng-container>

              <!-- Disinfection Column -->
              <ng-container matColumnDef="disinfection">
                <th mat-header-cell *matHeaderCellDef class="text-center"> Disinfection </th>
                <td mat-cell *matCellDef="let el" class="text-center">
                  <mat-icon *ngIf="el.disinfection" color="primary" svgIcon="heroicons_solid:check-circle"></mat-icon>
                  <mat-icon *ngIf="!el.disinfection" color="danger" svgIcon="heroicons_solid:minus-circle"></mat-icon>
              </ng-container>

              <!-- Quarantine Column -->
              <ng-container matColumnDef="quarantine">
                <th mat-header-cell *matHeaderCellDef class="text-center"> Quarantine </th>
                <td mat-cell *matCellDef="let el" class="text-center">
                  <mat-icon *ngIf="el.quarantine" color="primary" svgIcon="heroicons_solid:check-circle"></mat-icon>
                  <mat-icon *ngIf="!el.quarantine" color="danger" svgIcon="heroicons_solid:minus-circle"></mat-icon>
              </ng-container>

              <!-- Tested Column -->
              <ng-container matColumnDef="tested">
                <th mat-header-cell *matHeaderCellDef class="text-center"> Tested </th>
                <td mat-cell *matCellDef="let el" class="text-center">
                  <mat-icon *ngIf="el.tested" color="primary" svgIcon="heroicons_solid:check-circle"></mat-icon>
                  <mat-icon *ngIf="!el.tested" color="danger" svgIcon="heroicons_solid:minus-circle"></mat-icon>
              </ng-container>

              <!-- Vaccination Column -->
              <ng-container matColumnDef="vaccinated">
                <th mat-header-cell *matHeaderCellDef class="text-center"> Vaccination </th>
                <td mat-cell *matCellDef="let el" class="text-center">
                  <mat-icon *ngIf="el.vaccinated" color="primary" svgIcon="heroicons_solid:check-circle"></mat-icon>
                  <mat-icon *ngIf="!el.vaccinated" color="danger" svgIcon="heroicons_solid:minus-circle"></mat-icon>
              </ng-container>

              <!-- Movement control Column -->
              <ng-container matColumnDef="movementControl">
                <th mat-header-cell *matHeaderCellDef class="text-center"> Movement Control </th>
                <td mat-cell *matCellDef="let el" class="text-center">
                  <mat-icon *ngIf="el.movementControl" color="primary"
                    svgIcon="heroicons_solid:check-circle"></mat-icon>
                  <mat-icon *ngIf="!el.movementControl" color="danger"
                    svgIcon="heroicons_solid:minus-circle"></mat-icon>
              </ng-container>

              <!-- Observation Column -->
              <ng-container matColumnDef="observation">
                <th mat-header-cell *matHeaderCellDef class="text-center"> Observation (in case of bite) </th>
                <td mat-cell *matCellDef="let el" class="text-center">
                  <mat-icon *ngIf="el.observation" color="primary" svgIcon="heroicons_solid:check-circle"></mat-icon>
                  <mat-icon *ngIf="!el.observation" color="danger" svgIcon="heroicons_solid:minus-circle"></mat-icon>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="actionsInfoColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: actionsInfoColumns;"></tr>

            </table>
          </div>

          <mat-tab-group mat-stretch-tabs="false" mat-align-tabs="start">
            <mat-tab *ngIf="(report$ | async)?.diagnosticTests?.length" label="Diagnostic Tests">
              <div class="mb-4">
                <table mat-table [dataSource]="(report$ | async)?.diagnosticTests" class="w-full">
                  <!-- Id Column -->
                  <ng-container matColumnDef="id">
                    <th mat-header-cell *matHeaderCellDef> ID </th>
                    <td mat-cell *matCellDef="let el"> {{el.id}} </td>
                  </ng-container>

                  <!-- Name Column -->
                  <ng-container matColumnDef="testName">
                    <th mat-header-cell *matHeaderCellDef> Name </th>
                    <td mat-cell *matCellDef="let el"> {{el.name}} </td>
                  </ng-container>

                  <!-- Munber Tested Column -->
                  <ng-container matColumnDef="numberTested">
                    <th mat-header-cell *matHeaderCellDef> Number Tested </th>
                    <td mat-cell *matCellDef="let el"> {{el.numberTested}} </td>
                  </ng-container>

                  <!-- Number Positive Column -->
                  <ng-container matColumnDef="numberPositive">
                    <th mat-header-cell *matHeaderCellDef> Number Positive </th>
                    <td mat-cell *matCellDef="let el"> {{el.numberPositive}} </td>
                  </ng-container>

                  <!-- Number Negative Column -->
                  <!-- <ng-container matColumnDef="numberNegative">
                    <th mat-header-cell *matHeaderCellDef> Number Negative </th>
                    <td mat-cell *matCellDef="let el"> {{el.numberNegative}} </td>
                  </ng-container> -->

                  <!-- Number Undetermined Column -->
                  <!-- <ng-container matColumnDef="numberUndetermined">
                    <th mat-header-cell *matHeaderCellDef> Number Undetermined </th>
                    <td mat-cell *matCellDef="let el"> {{el.numberTested - (el.numberPositive + el.numberNegative) }}
                    </td>
                  </ng-container> -->

                  <!-- Professional Name Column -->
                  <ng-container matColumnDef="professionalName">
                    <th mat-header-cell *matHeaderCellDef> Tested by </th>
                    <td mat-cell *matCellDef="let el"> {{el.professionalName}} </td>
                  </ng-container>

                  <tr mat-header-row *matHeaderRowDef="diagnosticTestColumns"></tr>
                  <tr mat-row *matRowDef="let row; columns: diagnosticTestColumns;"></tr>

                </table>
              </div>
            </mat-tab>
            <mat-tab *ngIf="(report$ | async)?.medications?.length" label="Medications">
              <div class="mb-4">
                <table mat-table [dataSource]="(report$ | async)?.medications" class="w-full">
                  <!-- Id Column -->
                  <ng-container matColumnDef="id">
                    <th mat-header-cell *matHeaderCellDef> ID </th>
                    <td mat-cell *matCellDef="let el"> {{el.id}} </td>
                  </ng-container>

                  <!-- Name Column -->
                  <ng-container matColumnDef="name">
                    <th mat-header-cell *matHeaderCellDef> Name </th>
                    <td mat-cell *matCellDef="let el"> {{el.name}} </td>
                  </ng-container>

                  <!-- Dosage Column -->
                  <ng-container matColumnDef="dosage">
                    <th mat-header-cell *matHeaderCellDef> Dosage </th>
                    <td mat-cell *matCellDef="let el"> {{el.dosage}} </td>
                  </ng-container>

                  <tr mat-header-row *matHeaderRowDef="medicationColumns"></tr>
                  <tr mat-row *matRowDef="let row; columns: medicationColumns;"></tr>

                </table>
              </div>
            </mat-tab>
            <mat-tab *ngIf="(report$ | async)?.vaccinations?.length" label="Vaccinations">
              <div class="mb-4">
                <table mat-table [dataSource]="(report$ | async)?.vaccinations" class="w-full">
                  <!-- Id Column -->
                  <ng-container matColumnDef="id">
                    <th mat-header-cell *matHeaderCellDef> ID </th>
                    <td mat-cell *matCellDef="let el"> {{el.id}} </td>
                  </ng-container>

                  <!-- Name Column -->
                  <ng-container matColumnDef="vaccineName">
                    <th mat-header-cell *matHeaderCellDef> Name </th>
                    <td mat-cell *matCellDef="let el"> {{el.name}} </td>
                  </ng-container>

                  <!-- Munber Vaccinated Column -->
                  <ng-container matColumnDef="numberVaccinated">
                    <th mat-header-cell *matHeaderCellDef> Number Vaccinated </th>
                    <td mat-cell *matCellDef="let el"> {{el.numberVaccinated}} </td>
                  </ng-container>

                  <!-- Munber Vaccinated Column -->
                  <ng-container matColumnDef="humansVaccinated">
                    <th mat-header-cell *matHeaderCellDef> Humans Vaccinated </th>
                    <td mat-cell *matCellDef="let el"> {{el.isHuman ? "Yes" : "No"}} </td>
                  </ng-container>

                  <!-- Munber Vaccinated Column -->
                  <ng-container matColumnDef="animalsVaccinated">
                    <th mat-header-cell *matHeaderCellDef> Animals Vaccinated </th>
                    <td mat-cell *matCellDef="let el"> {{el.isAnimal ? "Yes" : "No"}} </td>
                  </ng-container>

                  <!-- Professional Name Column -->
                  <ng-container matColumnDef="professionalName">
                    <th mat-header-cell *matHeaderCellDef> Vaccinated by </th>
                    <td mat-cell *matCellDef="let el"> {{el.professionalName}} </td>
                  </ng-container>

                  <tr mat-header-row *matHeaderRowDef="vaccinationColumns"></tr>
                  <tr mat-row *matRowDef="let row; columns: vaccinationColumns;"></tr>
                </table>
              </div>
            </mat-tab>
          </mat-tab-group>

          <!-- <pre>
            {{ (report$ | async) | json }}
          </pre> -->
        </div>

        <div class="flex justify-between my-4">
          <a [routerLink]="['/dashboard/reports']" class="px-8" mat-flat-button [color]="'accent'">
            Back
          </a>
          <button *ngIf="canVerify" class="px-8" mat-flat-button [color]="'primary'" type="button"
            [disabled]="!canVerify" (click)="verify()">
            <span *ngIf="!( loading$ | async )">
              Verify Report
            </span>
            <mat-progress-spinner *ngIf="( loading$ | async )" [diameter]="24"
              [mode]="'indeterminate'"></mat-progress-spinner>
          </button>
        </div>

      </div>
    </div>
  </div>